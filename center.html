<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="./js/vue.js"></script>
    <script src="./js/jquery-3.3.1.js"></script>
    <script src="./js/draw.js"></script>

    <script src="./js/element.js"></script>
    <link rel="stylesheet" href="./css/element.css">

    <script type="text/javascript" src="http://127.0.0.1/cd2/static/bdmap/map_load.js"></script>
    <script src="./js/heatmap.min.js"></script>

    <script type="text/javascript" src="http://api.map.baidu.com/getscript?v=3.0&ak=Dn7WS2XQ8OuAN6oIP9dHieHOOsqKIjOt"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>

    <style>
        #map_demo {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
        }
        #bt{
            position: absolute;
            left: 20px;
            top: 20px;
            width: 200px;
            height: 30px;
        }
        #wss {
            position: absolute;
            left: 20px;
            top: 20px;
            font-size: 26px;
        }
#tabs{
    background: cadetblue;
    width: 500px;
    height: 1000px;
    font-size: 24px;
    font-weight: 700;
    display: none;
/*color:white;*/
}
.label{
    height: 30px;
}
span{
    /*color: crimson;*/
}
    </style>
    <style>/*去除百度地图版权*/
    .anchorBL{
        display:none;
    }
    </style>
</head>
<body>

<div id="app">
    <div id="map_demo" ref="allmap"></div>
    <div id="bt">
        <!--<button  style="float:left;" @click="drawDist('营子区')">营子区</button>-->
        <!--<button  style="float:left;" @click="drawDist('双桥区')">双桥区</button>-->
        <!--<button  style="float:left;" @click="heatMap('负载率')">负载率热力图</button>-->
        <!--<button  style="float:left;" @click="drawScope('my513')">my513</button>-->
        <!--<button  style="float:left;" @click="drawLine('nj514')">nj514</button>-->
        <!--<button  style="float:left;" @click="drawLine('my513')">my513</button>-->
        <!--&lt;!&ndash;<button  style="float:left;" @click="drawLine('yd511')">yd511</button>&ndash;&gt;-->
        <!--<button  style="float:left;" @click=" drawCD()">承德市</button>-->
        <button  style="float:left;" @click=" show_DataWindow(150677000000003)">设备点1</button>
        <button  style="float:left;" @click=" drawPoint(150677000000003)">设备点2</button>
        <button  style="float:left;" @click=" drawPoint(200677000000009)">设备点3</button>
        <button  style="float:left;" @click=" drawPoint(130677000000032)">设备点4</button>

        <!--<button  style="float:left;" @click="activeName = 'second'">运行数据</button>-->
        <!--<button  style="float:left;" @click="zoomIn()">放大</button>-->
        <!--<button  style="float:left;" @click="showInfo(1)">自动</button>-->
        <!--<button  style="float:left;" @click="addCheckbox('110')">110</button>-->
        <!--<button  style="float:left;" @click="addCheckbox('220')">220</button>-->
        <!--<button  style="float:left;" @click="test()">画线</button>-->
        <!--<el-button type="info">信息按钮</el-button>-->
    </div>
    <!--1.设置 wss 显示的位置，通过mqtt传递参数  lg,lat-->
    <!--2.设置 wss 显示的内容，根据设备类型 ，通过mqtt传递参数 type-->

    <div id='wss'>
        <el-tabs v-model="activeName" type="card" id="tabs">
            <el-tab-pane label="基础数据" name="first" >
                <div v-if="type==='变电站'">
                    资产性质:{{this.bdz.nature_assets}} <br>
                    经度:{{this.bdz.longitude}} <br>
                    纬度:{{this.bdz.latitude}} <br>
                    电站名称:{{this.bdz.name}} <br>
                    运维单位:{{this.bdz.maintenance}} <br>
                    电压等级:{{this.bdz.voltage}} <br>
                    投运日期:{{this.bdz.date_commissioning}} <br>
                    是否智能变电站:{{this.bdz.is_intelligent_substation}} <br>
                    电站重要级别:{{this.bdz.important_power_station}} <br>
                    是否农网:{{this.bdz.is_farm_network}} <br>
                    布置方式:{{this.bdz.layout_mode}} <br>
                    站址:{{this.bdz.xxh}} <br>
                    建筑面积(m*m):{{this.bdz.building_area}} <br>
                    地区特征:{{this.bdz.regional_characteristics}} <br>
                    联系电话:{{this.bdz.contact_number}} <br>
                    工程名称:{{this.bdz.project_name}} <br>
                    施工单位:{{this.bdz.construction_unit}} <br>
                    功能位置编码:{{this.bdz.functional_location_coding}} <br>
                    消防验收情况:{{this.bdz.fire_acceptance}} <br>
                    设备主人:{{this.bdz.equipment_owner}} <br>
                    是否负荷站:{{this.bdz.whether_load_station}} <br>
                    容量(MVA):{{this.bdz.capacity}} <br>
                    资产单位:{{this.bdz.asset_unit}} <br>
                    所属地市:{{this.bdz.subordinate_prefectures}} <br>
                    维护班组:{{this.bdz.maintenance_team}} <br>
                    设备状态:{{this.bdz.equipment_status}} <br>
                    电站类型:{{this.bdz.types_of_power_plants}} <br>
                    是否枢纽站:{{this.bdz.is_hub_station}} <br>
                    是否代维:{{this.bdz.is_daiwei}} <br>
                    值班方式:{{this.bdz.duty_mode}} <br>
                    污秽等级:{{this.bdz.contamination_grade}} <br>
                    占地面积(m*m):{{this.bdz.coverage}} <br>
                    海拔(m):{{this.bdz.elevation}} <br>
                    退役日期:{{this.bdz.retirement_date}} <br>
                    工程编号:{{this.bdz.engineering_number}} <br>
                    设计单位:{{this.bdz.design_unit}} <br>
                    监理单位:{{this.bdz.construction_control}} <br>
                    是否GIS变电站:{{this.bdz.whether_gis_substation}} <br>
                    消防类型:{{this.bdz.fire_fighting_types}} <br>
                    专业分类:{{this.bdz.professional_classification}} <br>
                    供电区域 :{{this.bdz.power_supply_area}} <br>
                </div>
                <div v-else-if="type==='电缆分接箱'">
                    资产性质:{{this.df.nature_assets}}<br>
                    经度:{{this.df.longitude}}<br>
                    纬度:{{this.df.latitude}}<br>
                    工程编号:{{this.df.engineering_number}}<br>
                    工程名称:{{this.df.project_name}}<br>
                    实物ID:{{this.df.physical_id}}<br>
                    设备名称:{{this.df.name}}<br>
                    所属地市:{{this.df.subordinate_prefectures}}<br>
                    维护班组:{{this.df.maintenance_team}}<br>
                    设备状态:{{this.df.equipment_status}}<br>
                    是否代维:{{this.df.is_daiwei}}<br>
                    型号:{{this.df.model}}<br>
                    出厂编号:{{this.df.exit_number}}<br>
                    投运日期:{{this.df.date_commissioning}}<br>
                    站址:{{this.df.xxh}}<br>
                    重要程度:{{this.df.importance}}<br>
                    专业分类:{{this.df.professional_classific}}<br>
                    功能位置编码:{{this.df.location_coding}}<br>
                    资产单位:{{this.df.asset_unit}}<br>
                    资产编号:{{this.df.asset_number}}<br>
                    设备增加方式:{{this.df.equipment_increase_mode}}<br>
                    运行编号:{{this.df.operation_number}}<br>
                    运维单位:{{this.df.maintenance}}<br>
                    电压等级:{{this.df.voltage}}<br>
                    是否农网:{{this.df.is_farm_network}}<br>
                    类型:{{this.df.type}}<br>
                    生产厂家:{{this.df.manufacturer}}<br>
                    出厂日期:{{this.df.date_of_production}}<br>
                    接地电阻(Ω):{{this.df.grounding_resistance}}<br>
                    地区特征:{{this.df.regional_char}}<br>
                    设备主人:{{this.df.equipment_owner}}<br>
                    供电区域:{{this.df.power_supply_area}}<br>
                </div>
                <div v-else-if="type==='开闭站'">
                    资产性质:{{this.kbz.Nature_assets}}<br>
                    开闭站电站名称:{{this.kbz.name}}<br>
                    经度:{{this.kbz.longitude}}<br>
                    纬度:{{this.kbz.latitude}}<br>
                    所属地市:{{this.kbz.Subordinate}}<br>
                    维护班组:{{this.kbz.Maintenance_team}}<br>
                    设备状态:{{this.kbz.Equipment_status}}<br>
                    电站类型:{{this.kbz.Types_of_power_plants}}<br>
                    是否代维:{{this.kbz.Is_Daiwei}}<br>
                    布置方式:{{this.kbz.Layout_mode}}<br>
                    占地面积(m*m):{{this.kbz.Coverage}}<br>
                    海拔(m):{{this.kbz.Elevation}}<br>
                    是否GIS变电站:{{this.kbz.GIS_Substation}}<br>
                    值班方式:{{this.kbz.Duty_mode}}<br>
                    备用进出线间隔数:{{this.kbz.Spacing_between_Lines}}<br>
                    污秽等级:{{this.kbz.Contamination_Grade}}<br>
                    功能位置编码:{{this.kbz.Functional_Location_Coding}}<br>
                    资产单位:{{this.kbz.Asset_unit}}<br>
                    运行编号:{{this.kbz.Operational_Number}}<br>
                    运维单位:{{this.kbz.maintenance}}<br>
                    电压等级:{{this.kbz.voltage}}<br>
                    投运日期:{{this.kbz.date_commissioning}}<br>
                    防误方式:{{this.kbz.Ways_to_prevent_mistakes}}<br>
                    是否农网:{{this.kbz.Is_it_a_farm_network}}<br>
                    站址:{{this.kbz.xxh}}<br>
                    建筑面积(m*m):{{this.kbz.Building_area}}<br>
                    地区特征:{{this.kbz.Regional_characteristics}}<br>
                    专业分类:{{this.kbz.Professional_classification}}<br>
                    重要程度:{{this.kbz.Importance}}<br>
                    供电区域 :{{this.kbz.Power_supply_area}}<br>
                </div>
                <div v-else-if="type==='线路'">
                    线路名称：{{xl.feederName}}<br>
                    所带配变数:{{xl.dmsSectionCount}}<br>
                    分支数:{{xl.dmsSectionCount}}<br>
                    容量:{{xl.ratedCurrent}}<br>
                    线路长度:{{xl.lineLength}}<br>
                    实时负荷:{{xl.activePower}}<br>
                    实时负载率:{{xl.currentLoading}}<br>
                </div>
            </el-tab-pane>
            <el-tab-pane label="运行数据" name="second">
                <div v-if="type==='变电站'">
                </div>
                <div v-else-if="type==='电缆分接箱'">
                </div>
                <div v-else-if="type==='开闭站'">
                </div>
                <div v-else-if="type==='线路'">
                </div>
            </el-tab-pane>
            <el-tab-pane label="其他数据" name="third">
                <div v-if="type==='变电站'">
                    电站简称:{{this.bdz.abbr_name}} <br>
                    是否满足N-1:{{this.bdz.is_n_1}} <br>
                    是否接入故障信息远传系统:{{this.bdz.can_access_tele_system}} <br>
                    设备编码:{{this.bdz.equipment_coding}} <br>
                    最高调度管辖权:{{this.bdz.dispatching_jurisdiction}} <br>
                    是否接入AVC:{{this.bdz.access_to_avc}} <br>
                    是否集中监控:{{this.bdz.is_centralize_monitoring}} <br>
                    登记时间:{{this.bdz.registration_time}} <br>
                    发布状态:{{this.bdz.publication_status}} <br>
                    备注 :{{this.bdz.remarks}} <br>
                </div>
                <div v-else-if="type==='电缆分接箱'">
                    设备编码:{{this.df.equipment_coding}}<br>
                    登记时间:{{this.df.registration_time}}<br>
                    发布状态:{{this.df.publication_status}}<br>
                    备注 :{{this.df.remarks}}<br>
                </div>
                <div v-else-if="type==='开闭站'">
                    电站简称:{{this.kbz.abbr_name}}<br>
                    是否满足N-1:{{this.kbz.is_n_1}}<br>
                    是否接入故障信息远传系统:{{this.kbz.can_access_tele_system}}<br>
                    电站ID:{{this.kbz.station_id}}<br>
                    设备编码:{{this.kbz.equipment_coding}}<br>
                    发布状态:{{this.kbz.publication_status}}<br>
                    最高调度管辖权:{{this.kbz.supreme_dispatching}}<br>
                    是否接入AVC:{{this.kbz.access_to_avc}}<br>
                    是否集中监控:{{this.kbz.is_centralize_monitor}}<br>
                    登记时间:{{this.kbz.registration_time}}<br>
                    备注 :{{this.kbz.remarks}}<br>
                </div>
                <div v-else-if="type==='线路'">
                </div>
            </el-tab-pane>
        </el-tabs>


    </div>


</div>
<script type="text/javascript">
    var vm = new Vue({
        el: '#app',
        data:{
            msg:'nihao',
            sb_data:{
                "bdz":[
                    {"id":110677000000003,"nature_assets":"省（直辖市、自治区）公司","longitude":"117.9646359","latitude":"40.93665088","name":"南郊变电站","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流110kV","date_commissioning":"1992-11-21","is_intelligent_substation":"否","important_power_station":"四类变电站","is_farm_network":"否","layout_mode":"常规","xxh":"河北省承德市双桥区开发区雹神庙村","building_area":"8004.000","regional_characteristics":"市区","contact_number":"","project_name":"","construction_unit":"","functional_location_coding":"01-DEA0-S-30012","fire_acceptance":"","equipment_owner":"","whether_load_station":"","capacity":"100","asset_unit":"国网冀北电力有限公司","subordinate_prefectures":"国网承德供电公司","maintenance_team":"变电运维一班","equipment_status":"在运","types_of_power_plants":"变电站","is_hub_station":"否","is_daiwei":"否","duty_mode":"无人值班","contamination_grade":"a级","coverage":"8004.000","elevation":"","retirement_date":"","engineering_number":"","design_unit":"","construction_control":"","whether_gis_substation":"否","fire_fighting_types":"","professional_classification":"变电","power_supply_area":"","abbr_name":"","is_n_1":"","can_access_tele_system":"","equipment_coding":"01M10000001117639","dispatching_jurisdiction":"承德地调","access_to_avc":"","is_centralize_monitoring":"","registration_time":"1992-11-26","publication_status":"发布","remarks":""},

                ],
                "kbz":
                    [
                        {"id":150677000000003,"Nature_assets":"省（直辖市、自治区）公司","name":"师专开闭站","longitude":"117.9638649","latitude":"40.89529603","Subordinate":"国网承德供电公司","Maintenance_team":"高新区配电运检班","Equipment_status":"在运","Types_of_power_plants":"开关站","Is_Daiwei":"否","Layout_mode":"常规","Coverage":"","Elevation":"","GIS_Substation":"否","Duty_mode":"无人值班","Spacing_between_Lines":"1","Contamination_Grade":"c级","Functional_Location_Coding":"01-DEA0-D-40840","Asset_unit":"国网冀北电力有限公司","Operational_Number":"622","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","date_commissioning":"2010-07-16","Ways_to_prevent_mistakes":"","Is_it_a_farm_network":"否","xxh":"承德民族师范学院南门东侧","Building_area":"","Regional_characteristics":"市区","Professional_classification":"配电","Importance":"一般","Power_supply_area":"B","abbr_name":"","is_n_1":"","can_access_tele_system":"","station_id":"BE530B05-A4C1-4666-84A5-24EDD25622AB-57099","equipment_coding":"01M00000006350467","publication_status":"发布","supreme_dispatching":"","access_to_avc":"","is_centralize_monitor":"","registration_time":"2011-08-20","remarks":""},
                        {"id":150670000000053,"Nature_assets":"省（直辖市、自治区）公司","name":"4#开闭站","longitude":"117.9740976","latitude":"40.8924625","Subordinate":"国网承德供电公司","Maintenance_team":"高新区配电运检班","Equipment_status":"在运","Types_of_power_plants":"开关站","Is_Daiwei":"否","Layout_mode":"常规","Coverage":"","Elevation":"","GIS_Substation":"否","Duty_mode":"无人值班","Spacing_between_Lines":"1","Contamination_Grade":"c级","Functional_Location_Coding":"01-DEA0-D-40717","Asset_unit":"国网冀北电力有限公司","Operational_Number":"627","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","date_commissioning":"2009-08-01","Ways_to_prevent_mistakes":"机械闭锁","Is_it_a_farm_network":"否","xxh":"郭营子村内","Building_area":"","Regional_characteristics":"市区","Professional_classification":"配电","Importance":"一般","Power_supply_area":"B","abbr_name":"","is_n_1":"","can_access_tele_system":"","station_id":"BE530B05-A4C1-4666-84A5-24EDD25622AB-56824","equipment_coding":"01M00000006350289","publication_status":"发布","supreme_dispatching":"","access_to_avc":"","is_centralize_monitor":"","registration_time":"2011-08-20","remarks":""},
                        {"id":150677000000004,"Nature_assets":"省（直辖市、自治区）公司","name":"石油开闭站","longitude":"117.9653059","latitude":"40.90312325","Subordinate":"国网承德供电公司","Maintenance_team":"高新区配电运检班","Equipment_status":"在运","Types_of_power_plants":"开关站","Is_Daiwei":"否","Layout_mode":"常规","Coverage":"","Elevation":"","GIS_Substation":"否","Duty_mode":"无人值班","Spacing_between_Lines":"","Contamination_Grade":"c级","Functional_Location_Coding":"01-DEA0-D-40856","Asset_unit":"国网冀北电力有限公司","Operational_Number":"601","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","date_commissioning":"2007-08-01","Ways_to_prevent_mistakes":"","Is_it_a_farm_network":"否","xxh":"开发区大学城附近","Building_area":"","Regional_characteristics":"市区","Professional_classification":"配电","Importance":"一般","Power_supply_area":"B","abbr_name":"","is_n_1":"","can_access_tele_system":"","station_id":"BE530B05-A4C1-4666-84A5-24EDD25622AB-57369","equipment_coding":"01M00000006350637","publication_status":"发布","supreme_dispatching":"","access_to_avc":"","is_centralize_monitor":"","registration_time":"2011-08-20","remarks":""},

                    ],
                "df":
                    [
                        {"id":200677000000008,"nature_assets":"省（直辖市、自治区）公司","longitude":"117.959401","latitude":"40.90416272","engineering_number":"","project_name":"","physical_id":"","name":"南514线路1#","subordinate_prefectures":"国网承德供电公司","maintenance_team":"高新区配电运检班","equipment_status":"在运","is_daiwei":"否","model":"DF4-600","exit_number":"","date_commissioning":"1991-08-24","xxh":"","importance":"一般","professional_classific":"配电","location_coding":"01-DEA0-D-40690","asset_unit":"国网冀北电力有限公司","asset_number":"160200024853","equipment_increase_mode":"","operation_number":"N514-FZX-SY03","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","is_farm_network":"否","type":"电缆分支箱","manufacturer":"北京清畅电力技术股份有限公司","date_of_production":"","grounding_resistance":"5.0000","regional_char":"市区","equipment_owner":"","power_supply_area":"B","equipment_coding":"01M00000006521477","registration_time":"2011-08-24","publication_status":"发布","remarks":""},
                        {"id":200677000000009,"nature_assets":"省（直辖市、自治区）公司","longitude":"117.9633239","latitude":"40.93079041","engineering_number":"","project_name":"","physical_id":"","name":"南514线路2#电缆接线箱","subordinate_prefectures":"国网承德供电公司","maintenance_team":"电缆运检二班","equipment_status":"在运","is_daiwei":"否","model":"HWG-12-5F","exit_number":"","date_commissioning":"1991-08-22","xxh":"","importance":"一般","professional_classific":"配电","location_coding":"01-DEA0-D-40692","asset_unit":"国网冀北电力有限公司","asset_number":"160200014675","equipment_increase_mode":"","operation_number":"N514-FZX01","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","is_farm_network":"否","type":"电缆分支箱","manufacturer":"北京科锐配电自动化股份有限公司","date_of_production":"","grounding_resistance":"5.0000","regional_char":"市区","equipment_owner":"","power_supply_area":"B","equipment_coding":"01M00000006445861","registration_time":"2011-08-22","publication_status":"发布","remarks":""},
                        {"id":200677000000010,"nature_assets":"省（直辖市、自治区）公司","longitude":"117.9614118","latitude":"40.92646686","engineering_number":"","project_name":"","physical_id":"","name":"南514线路3#电缆分接箱","subordinate_prefectures":"国网承德供电公司","maintenance_team":"电缆运检二班","equipment_status":"在运","is_daiwei":"否","model":"HWG-12-5F","exit_number":"","date_commissioning":"1991-08-22","xxh":"","importance":"一般","professional_classific":"配电","location_coding":"01-DEA0-D-40693","asset_unit":"国网冀北电力有限公司","asset_number":"160200014676","equipment_increase_mode":"","operation_number":"N514-FZX02","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","is_farm_network":"否","type":"电缆分支箱","manufacturer":"北京科锐配电自动化股份有限公司","date_of_production":"","grounding_resistance":"5.0000","regional_char":"市区","equipment_owner":"","power_supply_area":"B","equipment_coding":"01M00000006445881","registration_time":"2011-08-22","publication_status":"发布","remarks":""},
                        {"id":200677000000011,"nature_assets":"省（直辖市、自治区）公司","longitude":"117.9597811","latitude":"40.92284059","engineering_number":"","project_name":"","physical_id":"","name":"南514线路4#电缆分接箱","subordinate_prefectures":"国网承德供电公司","maintenance_team":"电缆运检二班","equipment_status":"在运","is_daiwei":"否","model":"HWG-12-5F","exit_number":"","date_commissioning":"1991-08-22","xxh":"","importance":"一般","professional_classific":"配电","location_coding":"01-DEA0-D-40694","asset_unit":"国网冀北电力有限公司","asset_number":"160200014677","equipment_increase_mode":"","operation_number":"N514-FZX03","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","is_farm_network":"否","type":"电缆分支箱","manufacturer":"北京科锐配电自动化股份有限公司","date_of_production":"","grounding_resistance":"5.0000","regional_char":"市区","equipment_owner":"","power_supply_area":"B","equipment_coding":"01M00000006445895","registration_time":"2011-08-22","publication_status":"发布","remarks":""},
                        {"id":200677000000012,"nature_assets":"省（直辖市、自治区）公司","longitude":"117.9735249","latitude":"40.89700171","engineering_number":"","project_name":"","physical_id":"","name":"南514线路4#箱","subordinate_prefectures":"国网承德供电公司","maintenance_team":"电缆运检二班","equipment_status":"在运","is_daiwei":"否","model":"DF4-600","exit_number":"","date_commissioning":"2004-08-24","xxh":"","importance":"一般","professional_classific":"配电","location_coding":"01-DEA0-D-40695","asset_unit":"国网冀北电力有限公司","asset_number":"160200014678","equipment_increase_mode":"","operation_number":"N514-FZX-SY04","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","is_farm_network":"否","type":"电缆分支箱","manufacturer":"北京清畅电力技术股份有限公司","date_of_production":"","grounding_resistance":"5.0000","regional_char":"市区","equipment_owner":"","power_supply_area":"B","equipment_coding":"01M00000006521764","registration_time":"2011-08-24","publication_status":"发布","remarks":""},
                        {"id":200677000000013,"nature_assets":"省（直辖市、自治区）公司","longitude":"117.9573629","latitude":"40.91666452","engineering_number":"","project_name":"","physical_id":"","name":"南514线路5#电缆分接箱","subordinate_prefectures":"国网承德供电公司","maintenance_team":"电缆运检二班","equipment_status":"在运","is_daiwei":"否","model":"HWG-12-5F","exit_number":"","date_commissioning":"1991-08-22","xxh":"","importance":"一般","professional_classific":"配电","location_coding":"01-DEA0-D-40696","asset_unit":"国网冀北电力有限公司","asset_number":"160200014679","equipment_increase_mode":"","operation_number":"N514-FZX04","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","is_farm_network":"否","type":"电缆分支箱","manufacturer":"北京科锐配电自动化股份有限公司","date_of_production":"","grounding_resistance":"5.0000","regional_char":"市区","equipment_owner":"","power_supply_area":"B","equipment_coding":"01M00000006445907","registration_time":"2011-08-22","publication_status":"发布","remarks":""},
                        {"id":200677000000014,"nature_assets":"省（直辖市、自治区）公司","longitude":"117.9563272","latitude":"40.911873","engineering_number":"","project_name":"","physical_id":"","name":"南514线路6#电缆分接箱","subordinate_prefectures":"国网承德供电公司","maintenance_team":"电缆运检二班","equipment_status":"在运","is_daiwei":"否","model":"HWG-12-5F","exit_number":"","date_commissioning":"1991-08-22","xxh":"","importance":"一般","professional_classific":"配电","location_coding":"01-DEA0-D-40697","asset_unit":"国网冀北电力有限公司","asset_number":"160200014680","equipment_increase_mode":"","operation_number":"N514-FZX05","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","is_farm_network":"否","type":"电缆分支箱","manufacturer":"北京科锐配电自动化股份有限公司","date_of_production":"","grounding_resistance":"5.0000","regional_char":"市区","equipment_owner":"","power_supply_area":"B","equipment_coding":"01M00000006446189","registration_time":"2011-08-22","publication_status":"发布","remarks":""},
                        {"id":200677000000015,"nature_assets":"省（直辖市、自治区）公司","longitude":"117.9563272","latitude":"40.911873","engineering_number":"","project_name":"","physical_id":"","name":"南514线路6#电缆分接箱","subordinate_prefectures":"国网承德供电公司","maintenance_team":"电缆运检二班","equipment_status":"在运","is_daiwei":"否","model":"HWG-12-5F","exit_number":"","date_commissioning":"1991-08-22","xxh":"","importance":"一般","professional_classific":"配电","location_coding":"01-DEA0-D-40697","asset_unit":"国网冀北电力有限公司","asset_number":"160200014680","equipment_increase_mode":"","operation_number":"N514-FZX05","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","is_farm_network":"否","type":"电缆分支箱","manufacturer":"北京科锐配电自动化股份有限公司","date_of_production":"","grounding_resistance":"5.0000","regional_char":"市区","equipment_owner":"","power_supply_area":"B","equipment_coding":"01M00000006522016","registration_time":"2011-08-24","publication_status":"发布","remarks":""},
                        {"id":200677000000016,"nature_assets":"省（直辖市、自治区）公司","longitude":"117.9608536","latitude":"40.9101937","engineering_number":"","project_name":"","physical_id":"","name":"南514线路7#电缆分接箱","subordinate_prefectures":"国网承德供电公司","maintenance_team":"电缆运检二班","equipment_status":"在运","is_daiwei":"否","model":"HWG-12-5F","exit_number":"","date_commissioning":"1991-08-22","xxh":"","importance":"一般","professional_classific":"配电","location_coding":"01-DEA0-D-40640","asset_unit":"国网冀北电力有限公司","asset_number":"160200014490","equipment_increase_mode":"","operation_number":"N514-FZX06","maintenance":"国网承德供电公司运维检修部(检修分公司)","voltage":"交流10kV","is_farm_network":"否","type":"电缆分支箱","manufacturer":"北京科锐配电自动化股份有限公司","date_of_production":"","grounding_resistance":"5.0000","regional_char":"市区","equipment_owner":"","power_supply_area":"B","equipment_coding":"01M00000006446208","registration_time":"2011-08-22","publication_status":"发布","remarks":""},

                    ]
            },
            bdz:{
                nature_assets:null,
                longitude:null,
                latitude:null,
                name:null,
                maintenance:null,
                voltage:null,
                date_commissioning:null,
                is_intelligent_substation:null,
                important_power_station:null,
                is_farm_network:null,
                layout_mode:null,
                xxh:null,
                building_area:null,
                regional_characteristics:null,
                contact_number:null,
                project_name:null,
                construction_unit:null,
                functional_location_coding:null,
                fire_acceptance:null,
                equipment_owner:null,
                whether_load_station:null,
                capacity:null,
                asset_unit:null,
                subordinate_prefectures:null,
                maintenance_team:null,
                equipment_status:null,
                types_of_power_plants:null,
                is_hub_station:null,
                is_daiwei:null,
                duty_mode:null,
                contamination_grade:null,
                coverage:null,
                elevation:null,
                retirement_date:null,
                engineering_number:null,
                design_unit:null,
                construction_control:null,
                whether_gis_substation:null,
                fire_fighting_types:null,
                professional_classificatio:null,
                power_supply_area:null,
                abbr_name:null,
                is_n_1:null,
                can_access_tele_system:null,
                equipment_coding:null,
                dispatching_jurisdiction:null,
                access_to_avc:null,
                is_centralize_monitoring:null,
                registration_time:null,
                publication_status:null,
                remarks:null,
            },
            kbz:{
                Nature_assets:'1',
                name:'2',
                longitude:'3',
                latitude:null,
                Subordinate:null,
                Maintenance_team:null,
                Equipment_status:null,
                Types_of_power_plants:null,
                Is_Daiwei:null,
                Layout_mode:null,
                Coverage:null,
                Elevation:null,
                GIS_Substation:null,
                Duty_mode:null,
                Spacing_between_Lines:null,
                Contamination_Grade:null,
                Functional_Location_Coding:null,
                Asset_unit:null,
                Operational_Number:null,
                maintenance:null,
                voltage:null,
                date_commissioning:null,
                Ways_to_prevent_mistakes:null,
                Is_it_a_farm_network:null,
                xxh:null,
                Building_area:null,
                Regional_characteristics:null,
                Professional_classification:null,
                Importance:null,
                Power_supply_area:null,
                abbr_name:null,
                is_n_1:null,
                can_access_tele_system:null,
                station_id:null,
                equipment_coding:null,
                publication_status:null,
                supreme_dispatching:null,
                access_to_avc:null,
                is_centralize_monitor:null,
                registration_time:null,
                remarks:null
            },
            df:{
                nature_assets:null,
                longitude:null,
                latitude:null,
                engineering_number:null,
                project_name:null,
                physical_id:null,
                name:null,
                subordinate_prefectures:null,
                maintenance_team:null,
                equipment_status:null,
                is_daiwei:null,
                model:null,
                exit_number:null,
                date_commissioning:null,
                xxh:null,
                importance:null,
                professional_classific:null,
                location_coding:null,
                asset_unit:null,
                asset_number:null,
                equipment_increase_mode:null,
                operation_number:null,
                maintenance:null,
                voltage:null,
                is_farm_network:null,
                type:null,
                manufacturer:null,
                date_of_production:null,
                grounding_resistance:null,
                regional_char:null,
                equipment_owner:null,
                power_supply_area:null,
                equipment_coding:null,
                registration_time:null,
                publication_status:null,
                remarks:null
            },
            xl:{
                feederName:'我是测试数据', // 线路名称
                dmsTransCount:'23', // 所带配变数
                dmsSectionCount: '4', //分支数
                ratedCurrent: '879',  //容量
                activePower: 'gag', //实时负荷
                lineLength: '122',  // 线路长度
                currentLoading:'rywy',  // 实时负载率
                currentLoadingHis: [] ,//负载率
                activePowerHis: [], //历史负荷
                ratedCurrentHis: [] // 载流量
            },
            activeName: 'first',
            type:'开闭站',
            sb_point:{},
            map: null,
            border:[],
            border_marker:[],
            checkbox1:[],
            xj: { 'p': [ ], 'c': [ ] }, //xj.p为各个点周围的户表的坐标对，xj.c为地图中各个点，
            wjj: [],
            xx: [],
            point_bdz:[],
            line_bdz:[],
            point:[],
            line:[],
            point_d:[],
            line_d:[],
            point_l:[],
            line_l:[],
            line_s:null,
            allMarker:[],
            selectedDist:[],
            selectedPoint:[],
            selectedPoint2:[],//选中的那个点
            selectedLine:[],
            selectedLine_s:[],
            scopePoint:[], // 画供电范围的点
            dist:'',
            flines:[],
            pb:[],
            hb:[],
            ml514:[],
            my513:[],
            psource: '',
            ptarget: '',
            fline:[],
            heatmapOverlay:null,
            heatPoints:[]
        },
        mounted () {

            this.getData();
                        this.init()
//            this.drawScope('my513');
        },
        methods: {
            init(){

                this.initMap()
            },
            setTabsLocate(x,y){
                document.getElementById('wss').style.left = x
            },
            setLocation( x,y,z) {
                this.map.centerAndZoom(new BMap.Point(x,y), z);
            },
            checkData(value){
                this.activeName = value
            },
            zoomIn(){
               // this.map.zoomIn()
				  let z =this.map.getZoom()
                    z = z+2
                    this.map.setZoom(z)
                this.showInfo(1)
            },
            addCheckbox(value){
                this.checkbox1.push(value)
                this.showInfo(2)
            },
            //筛选
            setCheckbox(value){
                this.checkbox1 =[]
                var arr = ["abc","dc","gah"]
                arr =value.split(',');
                this.checkbox1.push(...arr)
                this.showInfo(2)
            },
            //    // 获取当前区域的负载率 或者 户均容量
            showFZL(_dist, _type){
                var that = this
                that.heatPoints = []
                if(that.heatmapOverlay != null){
                    that.heatmapOverlay.hide()
                }
                $.ajax({
                    url: "http://127.0.0.1:8089/web/map/queryPoint",// 按条件筛选设备的接口
                    type: "POST",
                    data: '{"types":["配变"],"dist":"'+_dist+'"}',
                    contentType:"application/json",
                    dataType:"json",
                    async:false,
                    success: function(data) {//请求成功完成后要执行的方法
                        for(let element of data){
                            that.heatPoints.push({
                                "lng":element.lg,
                                "lat":element.lat,
                                "count":300  // element.fzl   element.hjrl
                            })
                        }

                    }
                })
            },
            //画热力图
            heatMap(_type){
                this.showFZL(this.dist,_type)
                this.heatmapOverlay = new BMapLib.HeatmapOverlay({"radius":20});
                this.map.addOverlay(this.heatmapOverlay);
                this.heatmapOverlay.setDataSet({data:this.heatPoints,max:400});
//                this.heatmapOverlay.show();
            },
            //承德市区域外 黑色
			onCd1(){
                var that =this
                $.ajax({
                    url:"http://127.0.0.1:8089/web/map/queryDistBoundary",
                    type: "POST",
                    data: '{"dist":"外边界"}',
                    contentType:"application/json",
                    dataType:"json",
                    async:false,
                    success: function (data) {
                        that.border = data
                        var dd =[]
                        for(let bb of that.border){
                            var p1 = new BMap.Point(bb.lg,bb.lat)
                            dd.push(p1)
                        }
                        var polygon = new BMap.Polygon(dd, {strokeColor: "#000000", strokeWeight: 0.01, strokeOpacity: 0.01, fillColor: '#000000', fillOpacity: 0.8 })
                        that.map.addOverlay(polygon)
                    }
                })
			},
			    //选中区县的边界
			onCd2 (_dist) {
			    for(let bb of this.border_marker){
                    this.map.removeOverlay(bb)
                }
			    var that =this
                $.ajax({
                    url:"http://127.0.0.1:8089/web/map/queryDistBoundary",
                    type: "POST",
                    data: '{"dist":"'+_dist+'"}',
                    contentType:"application/json",
                    dataType:"json",
                    async:false,
                    success: function (data) {
                        that.border = data
                        var dd =[]
                        for(let bb of that.border){
                            var p1 = new BMap.Point(bb.lg,bb.lat)
                            dd.push(p1)
                        }
                        var polygon = new BMap.Polygon(dd, { strokeColor:'#CD6839',strokeWeight: 1, strokeOpacity: 0.5,fillOpacity: 0.15 ,fillColor:'#CD6839'})
                        that.map.addOverlay(polygon)
                        that.border_marker.push(polygon)
                    }
                })
			},
            // 获取 所有变电站的point 以及变电站-变电站的连线
            getData(){
                var that =this
                $.ajax({
                    url: "http://127.0.0.1:8089/web/map/queryPoint",// 按条件筛选设备的接口
//                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                    type: "POST",
                    data: '{"types":["变电站"]}',
                    contentType:"application/json",
                    dataType:"json",
                    async:false,
                    success: function(data) {//请求成功完成后要执行的方法
//                        var result = JSON.stringify(data); //json对象转成字符串
                        that.point_bdz = data;
                    }
                })
                $.ajax({
                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                    type: "POST",
                    data: '{ "sourceType": "变电站","targetType": "变电站" }',  // 通过 id 筛选连线
                    contentType:"application/json",
                    dataType:"json",
                    async:false,
                    success: function(data) {//请求成功完成后要执行的方法
//                        var result = JSON.stringify(data); //json对象转成字符串
                        that.line_bdz = data;
                    }
                })
            },
            drawCD(){
                this.dist = '承德市'
                this.flines = []
                document.getElementById('tabs').style.display ='none'
                this.map.removeOverlay(this.heatmapOverlay)
			    if(this.allMarker.length != 0){
                    for (let item of this.allMarker) {
                        this.map.removeOverlay(item)  // 清理地图上的市级的点线
                    }
                }
                for(let bb of this.border_marker){
                    this.map.removeOverlay(bb)
                }
                if(this.selectedPoint2.length != 0 ){
                    for(let pp of this.selectedPoint2){
                        this.map.removeOverlay(pp)
                    }
                }
               if(this.selectedPoint.length != 0){
                    for (let item of this.selectedPoint) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                if(this.selectedLine.length != 0){
                    for (let item of this.selectedLine) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                    if(this.wjj.length != 0){
                    for (let item of this.wjj) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                var that = this

                // 画承德市的点
                for (let item of this.point_bdz) {
                    var icon = ''
                    if (item.voltage === 35) {
                        icon = new BMap.Icon('./images/cd35.png', new BMap.Size(70, 70), {
                            fillOpacity: 0.5,
                            anchor: new BMap.Size(35, 35)
                        })
                    } else if (item.voltage === 110) {
                        icon = new BMap.Icon('./images/cd110.png', new BMap.Size(70, 70), {
                            fillOpacity: 0.5,
                            anchor: new BMap.Size(35, 35)
                        })
                    } else if (item.voltage === 220) {
                        icon = new BMap.Icon('./images/cd220.png', new BMap.Size(70, 70), {
                            fillOpacity: 0.5,
                            anchor: new BMap.Size(35, 35)
                        })
                    } else if (item.voltage === 500) {
                        icon = new BMap.Icon('./images/cd500.png', new BMap.Size(70, 70), {
                            fillOpacity: 0.5,
                            anchor: new BMap.Size(35, 35)
                        })
                    }
                    // var n0 = new BMap.Icon('../cd/static/bdmap/images/n0.png', new BMap.Size(33, 34), { fillOpacity: 0.5, anchor: new BMap.Size(16, 17) })
                    var p0 = new BMap.Point(item.lg, item.lat)
                    var m0 = new BMap.Marker(p0, {icon: icon})
                    item["marker"]=m0
                    item["isShow"]= 'true'
                    this.allMarker.push(m0)
                    // xx.push(p0)
                    this.map.addOverlay(m0)

                    this.selectedPoint.push(m0)


                }
                //画承德市的线
                for(let li of this.line_bdz){
				  var dd = []
				       var p1,p2
               var line_color,line_style,line_weight
                    for (let po of this.point_bdz){
                        if(po.id === li.source){
                            p1 = new BMap.Point(po.lg, po.lat)
                        } else  if(po.id === li.target){
                            p2 = new BMap.Point(po.lg, po.lat)
							switch(po.voltage){
							  case 220:
							   line_color = 'purple'
							   line_style = 'solid'
							   line_weight = 2
								break
							  case 110:
								line_color = 'red'
								line_style = 'solid'
								line_weight = 2
								break
							  case 35:
								line_color = '#0000EE'
								line_style = 'solid'
								line_weight = 2
								break
							}
                        }
                    }

					       dd.push(p1)
//					   加入li的拐点
					   for(let go of li.guai){
					     var p = new BMap.Point(go.lg, go.lat)
					     dd.push(p)
                           var icon = new BMap.Icon('./images/gt.png', new BMap.Size(21, 21), { fillOpacity: 0.5, anchor: new BMap.Size(12, 12) })
                           var mm = new BMap.Marker(p, { icon: icon ,title:p.name})
                           this.map.addOverlay(mm)
                           this.allMarker.push(mm)
					   }
					  dd.push(p2)
					  //画连线

                    var polygon = new BMap.Polyline(dd, {strokeColor:line_color, strokeWeight: line_weight,strokeStyle: line_style, strokeOpacity: 1})
                    this.map.addOverlay(polygon)
                    li["line"]=polygon
                    this.selectedLine.push(polygon)
                }
                this.map.centerAndZoom(new BMap.Point(117.972845,41.23822764),11)
                this.showInfo(1);



            },
			//测试
			test(){
			var dd =[]
			var p1 = new BMap.Point(117.972845,40.955677)
			var p2 = new BMap.Point(117.872845,40.955677)
			var p3 = new BMap.Point(117.972845,40.655677)
			dd.push(p1)
			dd.push(p2)
			dd.push(p3)
			var polygon = new BMap.Polyline(dd, {strokeColor: 'blue', strokeWeight: 2, strokeOpacity: 0.5})
            this.map.addOverlay(polygon)
			     this.selectedLine.push(polygon)

			},
            showInfo (e) {
                var z = this.map.getZoom()
                var point =[]
                var line =[]
                // 根据当前层级判断point的值
              if(this.flines.length !=0){
				  point = this.point_l
				   line = this.line_l
			  }else{
				if(this.dist ==='承德市'){
				  point = this.point_bdz
				  line = this.line_bdz
				}else {
				  point = this.point_d
				  line = this.line_d
				}
			  }
                // 自动
                if(e ===1){
                    for(let po of this.selectedPoint2){
                        this.map.removeOverlay(po)
                    }
                    this.checkbox1 = []
                    // alert(z)   // 11  13 15
                    for (let po of point){
                        this.map.removeOverlay(po.marker)
                        switch(po.voltage){
                            case 35:
                                if (z >14) {this.map.addOverlay(po.marker) }
                                break
                            case 110:
                                if (z>12) {this.map.addOverlay(po.marker) }
                                break
                            case 220:
                                if (z>10) { this.map.addOverlay(po.marker) }
                                break
                            case 500:
                                if (z >10) { this.map.addOverlay(po.marker) }
                                break
                        }
                        switch(po.type){
                            case '开闭站':
                                if (z >14) {this.map.addOverlay(po.marker) }
                                break
                            case '环网柜':
                                if (z>14) {this.map.addOverlay(po.marker) }
                                break
                            case '熔断器':
                                if (z>14) {this.map.addOverlay(po.marker) }
                                break
                            case '配电室':
                                if (z>14) {this.map.addOverlay(po.marker) }
                                break
                            case '电缆分接箱':
                                if (z>14) {this.map.addOverlay(po.marker) }
                                break
                            case '箱式变电站':
                                if (z>14) {this.map.addOverlay(po.marker) }
                                break
                            case '配变':
                                if (z>14) { this.map.addOverlay(po.marker) }
                                break
                            case '杆塔':
                                if (z >14) { this.map.addOverlay(po.marker) }
                                break
                        }
                    }
                    for (let li of line){
                        this.map.removeOverlay(li.line)
                        switch(li.voltage){
                            case 220:
                                if (z>10) {this.map.addOverlay(li.line) }
                                break
                            case 110:
                                if (z>12) {this.map.addOverlay(li.line) }
                                break
                            case 35:
                                if (z >14) {  this.map.addOverlay(li.line) }
                                break
                            default:   // 其他都是单线图
                                if (z >14) {  this.map.addOverlay(li.line) }
                                break
                        }
                    }
                }
                // 多选
                if(e === 2){
                    // 反向选择 ，如果checkbox1不包含哪个，地图就把哪个删掉
                    for (let po of point){
                        this.map.removeOverlay(po.marker)
                        po.isShow = 'false'
                        if(po.type === '变电站'){
                            switch (po.voltage) {
                                case 35:
                                    if (this.checkbox1.indexOf('35') >= 0) {
                                        this.map.addOverlay(po.marker)
                                        po.isShow='true'
                                    }
                                    break
                                case 110:
                                    if (this.checkbox1.indexOf('110') >= 0) {
                                        this.map.addOverlay(po.marker)
                                        po.isShow='true'
                                    }
                                    break
                                case 220:
                                    if (this.checkbox1.indexOf('220') >= 0) {
                                        this.map.addOverlay(po.marker)
                                        po.isShow='true'
                                    }
                                    break
                                case 500:
                                    if (this.checkbox1.indexOf('500') >= 0) {
                                        this.map.addOverlay(po.marker)
                                        po.isShow='true'
                                    }
                                    break
                            }
                        }else {
                            if(po.type ==='配变'){
                                if (this.checkbox1.indexOf('配变') >= 0) {
                                    this.map.addOverlay(po.marker)
                                    po.isShow='true'
                                }
                            }else if(po.type ==='开闭站'){
                                if (this.checkbox1.indexOf('开闭站') >= 0) {
                                    this.map.addOverlay(po.marker)
                                    po.isShow='true'
                                }
                            }else if(po.type ==='环网柜'){
                                if (this.checkbox1.indexOf('环网柜') >= 0) {
                                    this.map.addOverlay(po.marker)
                                    po.isShow='true'
                                }
                            }else if(po.type ==='杆塔'){
                                po.isShow='true'
                            }
                        }
                    }
                    for (let li of line){
                        this.map.removeOverlay(li.line)
                        // 如果checkbox1包括source.voltage target.volget， 则这条线出现
                        var p1,p2
                        for(let po of point){
                            if(po.id === li.source){
                                p1 = po
                            }else if(po.id === li.target){
                                p2 = po
                            }
                        }
                        if((p1.isShow === 'true')&&(p2.isShow === 'true')){
                            this.map.addOverlay(li.line)
                        }
                    }
                }

            },
            //获取区县的点和线
            getDistData(_dist){
                var that =this
                $.ajax({
                    url: "http://127.0.0.1:8089/web/map/queryPoint",// 按条件筛选设备的接口
//                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                    type: "POST",
                    data: '{"types":["变电站","开闭站","环网柜"],"dist":"'+_dist+'"}',
                    contentType:"application/json",
                    dataType:"json",
                    async:false,
                    success: function(data) {//请求成功完成后要执行的方法
//                        var result = JSON.stringify(data); //json对象转成字符串
                        that.point_d = data;

                    }
                })
                $.ajax({
                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                    type: "POST",
                    data: '{"types":["变电站","开闭站","环网柜"], "dist":"'+ _dist+'"}',  // 通过 id 筛选连线
                    contentType:"application/json",
                    dataType:"json",
                    async:true,
                    success: function(data) {//请求成功完成后要执行的方法
//                        var result = JSON.stringify(data); //json对象转成字符串
                        that.line_d = data;

                    }
                })
            },
            getLineData(value){
                var that =this
                $.ajax({
                    url:"http://127.0.0.1:8089/index/getLineInfo",
                    type: "POST",
                    data: '{"fline":"'+value+'"}',
                    contentType:"application/json",
                    dataType:"json",
                    async:true,
                    success: function (response) {
                        that.xl =response

                    }
                })

            },
            // 获取 特定线路上的point 以及该线路的连线
            getLine(_line){
                var that =this
                $.ajax({
                    url: "http://127.0.0.1:8089/web/map/queryPoint",// 按条件筛选设备的接口
//                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                    type: "POST",
                    data: '{"flines":["'+_line+'"]}',
                    contentType:"application/json",
                    dataType:"json",
                    async:false,
                    success: function(data) {//请求成功完成后要执行的方法
//                        var result = JSON.stringify(data); //json对象转成字符串
                        that.point_l = data;
                        console.log(data)

                    }
                })
                $.ajax({
                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                    type: "POST",
                    data: '{ "fline":"'+ _line+'"}',  // 通过 id 筛选连线
                    contentType:"application/json",
                    dataType:"json",
                    async:false,
                    success: function(data) {//请求成功完成后要执行的方法

//                        var result = JSON.stringify(data); //json对象转成字符串
                        that.line_l = data;

                    }
                })
            },
            initMap () {

                let map = new BMap.Map(this.$refs.allmap)
//                let map = new BMap.Map('map_demo')
                this.map = map
//                map.centerAndZoom(new BMap.Point(117.585671, 41.422635), 9)
                var point = new BMap.Point(117.418261, 39.921984);
                map.centerAndZoom(point,9);
                map.enableScrollWheelZoom(true)
				this.onCd1()
                this.drawCD()
            },
            //获取配变
            getPbData(_line){
                var that =this
                $.ajax({
                    url: "http://127.0.0.1:8089/web/map/queryPoint",// 按条件筛选设备的接口
//                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                    type: "POST",
                    data: '{"types":["配变"],"flines":["'+_line+'"]}',
                    contentType:"application/json",
                    dataType:"json",
                    async:false,
                    success: function(data) {//请求成功完成后要执行的方法
//                        var result = JSON.stringify(data); //json对象转成字符串
                        that.pb = data;
                    }
                })
            },
			 //获取线路户表
            getLineBiao(_line){
                var that =this
                $.ajax({
                    url: "http://127.0.0.1:8089/web/map/queryBiao",// 按条件筛选设备的接口
//                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                    type: "POST",
                    data: '{"fline":"'+_line+'"}',
                    contentType:"application/json",
                    dataType:"json",
                    async:false,
                    success: function(data) {//请求成功完成后要执行的方法
//                        var result = JSON.stringify(data); //json对象转成字符串
                        that.hb = data;
                    }
                })
            },
            // 画供电范围
            drawScope(_line){
                this.getPbData(_line)
                if(this.scopePoint.length != 0){
                    for (let item of this.scopePoint) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                if(this.selectedPoint2.length != 0 ){
                    for(let pp of this.selectedPoint2){
                        this.map.removeOverlay(pp)
                    }
                }
                if(this.selectedPoint.length != 0 ){
                    for(let pp of this.selectedPoint){
                        this.map.removeOverlay(pp)
                    }
                }
                if(this.selectedLine.length != 0){
                    for (let item of this.selectedLine) {
                        this.map.removeOverlay(item)
                    }
                }
                if(this.wjj.length != 0){
                    for (let item of this.wjj) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                var c1 = new BMap.Icon('./images/circle.png', new BMap.Size(33, 34), { anchor: new BMap.Size(8, 8) })
                var dd = []

                for (let po of this.pb) {
                    var dd = []
                    for(let pp of po.biao){
                        var p1 = new BMap.Point(pp.lg, pp.lat)
                        dd.push(p1)
                    }
                    var polygon = new BMap.Polygon(dd, {strokeColor: '#3A5FCD', strokeWeight: 1, strokeOpacity: 0.5,fillColor:'#3A5FCD' ,fillOpacity: 0.6 })
                    this.map.addOverlay(polygon)
                    this.wjj.push(polygon)
                }
                this.map.setZoom(16)
            },
            // 画供电范围
            drawScope1(_line){
                this.getLineBiao(_line)
                if(this.scopePoint.length != 0){
                    for (let item of this.scopePoint) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                if(this.selectedPoint2.length != 0 ){
                    for(let pp of this.selectedPoint2){
                        this.map.removeOverlay(pp)
                    }
                }
                if(this.selectedPoint.length != 0 ){
                    for(let pp of this.selectedPoint){
                        this.map.removeOverlay(pp)
                    }
                }
                if(this.selectedLine.length != 0){
                    for (let item of this.selectedLine) {
                        this.map.removeOverlay(item)
                    }
                }
                if(this.wjj.length != 0){
                    for (let item of this.wjj) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                var c1 = new BMap.Icon('./images/circle.png', new BMap.Size(33, 34), { anchor: new BMap.Size(8, 8) })
                var dd = []
                for (let po of this.hb) {
                    var p1 = new BMap.Point(po.lg, po.lat)
                    var m1 = new BMap.Marker(p1, { icon: c1 })
                    this.map.addOverlay(m1)
                    this.wjj.push(m1)
                    dd.push(p1)
                }
                var polygon = new BMap.Polygon(dd, {strokeColor: 'blue', strokeWeight: 2, strokeOpacity: 0.5,fillOpacity: 0.1})
                this.map.addOverlay(polygon)
                this.wjj.push(polygon)
                this.map.setZoom(16)
            },
            // 以点放大居中， 是配变，则显示停电区域
            drawPoint(_point){
                // _point = msg.parameters.id 根据收到的消息
                document.getElementById('tabs').style.display ='none'

//                var that = this
                if(this.selectedPoint2.length != 0 ){
                    for(let pp of this.selectedPoint2){
                        this.map.removeOverlay(pp)
                    }
                }
                if(this.wjj.length != 0){
                    for (let item of this.wjj) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }

                // 选中的设备信息从接口获取的话，就直接是结果data
                var that =this
                $.ajax({
                    url: "http://127.0.0.1:8089/web/map/queryPoint",// 按条件筛选设备的接口
//                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                    type: "POST",
                    data: '{"id":"'+_point+'"}',
                    contentType:"application/json",
                    dataType:"json",
                    async:true,
                    success: function(data) {//请求成功完成后要执行的方法

//                        var result = JSON.stringify(data); //json对象转成字符串
//                        that.point = data;
                        let po =data[0]
                        that.type = po.type //获取当前数据类型
                        that.getSbData(_point) //获取当前设备数据
                        let label = new BMap.Label(po.name, { offset: new BMap.Size(-50, 70) })
                        label.setStyle({borderColor: '#4682B4',borderWidth:'4px',borderStyle:'double',fontSize:'20px',fontFamily:'黑体',fontWeight:'bold'})
                        let center = new BMap.Point(po.lg, po.lat)
                        that.map.centerAndZoom(center,16)
                        let marker = new BMap.Marker(center)
                        that.map.addOverlay(marker)
                        marker.setLabel(label)
                        that.selectedPoint2.push(marker)
//						//窗口显示选中点的相关信息
						var content = `<div style="background: cadetblue;margin-top:10px">
                                            <div class="data_item">设备名称：${po.name}</div><br>
                                            <div class="data_item">横坐标：${po.lg}</div><br>
                                            <div class="data_item">纵坐标：${po.lat}</div><br>
                                        </div>`
                         that.openInfo(po.lg, po.lat,_point,content)
						
                        // 如果该点type为配变，添加供电区域
                        if(po.type==='配变'){
                            // 画户表连线
                            // 添加供电区域
							  var dd =[]
							for (let pp of po.biao) {
							  var p1  = new BMap.Point(pp.lg, pp.lat)
							  dd.push(p1)
							}
						   var polygon = new BMap.Polygon(dd, {strokeColor: '#3A5FCD', strokeWeight: 1, strokeOpacity: 0.5,fillColor:'#3A5FCD' ,fillOpacity: 0.6})
							that.map.addOverlay(polygon)
							that.wjj.push(polygon)
					
                        }
                    }
                })

            },
            show_DataWindow(_activeName){
                this.activeName = _activeName
                document.getElementById('tabs').style.display = 'block' //让标签页显示
//                this.getSbData(_point)
            },
            getSbData(_point){
               // 因为不同类型设备的数据项不一样，所以要这样
                this.sb_point =null
                switch (this.type){
                    case '变电站':
                        this.sb_data.bdz.filter(item =>{
                            if(item.id === _point){
                                this.bdz = item
                                this.sb_point = item
                            }
                        })
                        break
                    case '开闭站':
                        this.sb_data.kbz.filter(item =>{
                            if(item.id == _point){
                                this.kbz = item
                                this.sb_point = item
                            }
                        })
                        break
                    case '电缆分接箱':
                        this.sb_data.df.filter(item =>{
                            if(item.id === _point){
                                this.df =  item
                                this.sb_point = item
                            }
                        })
                        break
                }
                console.log(this.kbz)
            },
		 //展示信息窗口
		  openInfo(x,y,_point,content){
                //  可以使用es6的模板字符串来写html
			  var opts ={
				  width:330,
				  height:400,
				  title:  `  <div id="info_title" style="color:white;background:cadetblue;height: 60px;margin-top:20px;font-size: 30px;font-weight: 800">
                                   <div style="padding-top:15px;">设备信息</div>
                              </div>`,
				  enableAutoPan:true , //是否开启信息窗口打开时地图自动移动（默认开启）
                  enableCloseOnClick: false  //是否开启点击地图关闭信息窗口（默认开启）
				}
			  var point =new BMap.Point(x,y)
              // 通过id 获取设备数据

              var po =  this.sb_point
              if(po != null){
                  content = content+`<div style="background: cadetblue;">
                                        <div class="data_item">设备编码：${po.id}</div><br>
                                        <div class="data_item">运维单位：${po.maintenance}</div><br>
                                        <div class="data_item">投运日期：${po.date_commissioning}</div><br>
                                        <div class="data_item">电压等级：${po.voltage}</div><br>
                                     </div>`
              }

			  var infoWindow = new BMap.InfoWindow(content,opts)
			  this.map.openInfoWindow(infoWindow,point)  // 在地图上加载信息窗口，（窗口的内容，窗口的位置）
			},
            // 以区域放大居中
            drawDist(_dist){
                this.getDistData(_dist)
                this.dist = _dist
                this.flines = []
                document.getElementById('tabs').style.display ='none'
                this.map.removeOverlay(this.heatmapOverlay)
                var that = this
                if(this.allMarker.length != 0 ){
                    for(let pp of this.allMarker){
                        this.map.removeOverlay(pp)
                    }
                }
                if(this.selectedPoint.length != 0){
                    for (let item of this.selectedPoint) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                if(this.selectedLine.length != 0){
                    for (let item of this.selectedLine) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                if(this.selectedPoint2.length != 0){
                    for (let item of this.selectedPoint2) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                if(this.wjj.length != 0){
                    for (let item of this.wjj) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
				this.onCd2(this.dist)

                    var center =''
                    switch(_dist){
                        case "营子区":
                            var center = new BMap.Point(117.663595, 40.552264)
                            break
                        case "双桥区":
                            var center = new BMap.Point(117.949714, 40.98148)
                            break
                        case "双滦区":
                            var center = new BMap.Point(117.801116,40.96473)
                            break
                        case "高新区":
                            var center = new BMap.Point(118.001196,40.770489)
                            break
                    }
                    this.map.centerAndZoom(center,15)
                    for (let item of that.point_d) {
                        if(item.dist === _dist){
                            var icon = ''
                            var label = new BMap.Label(item.name, { offset: new BMap.Size(-30, 45) })
                            var t = ""
                            if(item.type === '变电站'){
                                if(item.voltage=== 35){
                                    icon = new BMap.Icon('./images/35.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                                }else if(item.voltage===110){
                                    icon = new BMap.Icon('./images/110.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                                }else if(item.voltage=== 220){
                                    icon = new BMap.Icon('./images/220.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                                }else if(item.voltage===500){
                                    icon = new BMap.Icon('./images/500.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                                }
                                t = item.name.indexOf('变')
                                label = new BMap.Label(item.name.substr(0,t), { offset: new BMap.Size(-30, 40) })
                            }else {
                                switch(item.type){
                                    case '环网柜':
                                        icon = new BMap.Icon('./images/hwg.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                                        break
                                    case '开闭站':
                                        icon = new BMap.Icon('./images/kbz.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                                        break
                                    case '杆塔':
                                        icon = ''
                                        break
                                    default:
                                        icon = new BMap.Icon('./images/pb.png', new BMap.Size(70, 44), { fillOpacity: 0.5, anchor: new BMap.Size(35, 22) })
                                        break
                                }
                            }

                            var p0 = new BMap.Point(item.lg, item.lat)
                          var m0 = new BMap.Marker(p0, { icon: icon })
							if(item.type !== '杆塔'){
								this.map.addOverlay(m0)
							}
							this.selectedPoint.push(m0)
                            item["marker"]=m0
                            item["isShow"]= 'true'
                        }
                    }
                    //画区域的线
                var p1,p2
				var line_color,line_style,line_weight
                   for(let li of this.line_d){
                        for(let po of this.point_d){
                            if(po.id === li.source){
                                p1 = new BMap.Point(po.lg, po.lat)
                            } else  if(po.id === li.target){
                                p2 = new BMap.Point(po.lg, po.lat)
								if(po.type==='变电站'){
								  switch(po.voltage){
									case 220:
									line_color = 'purple'
									line_style = 'solid'
									line_weight = 2
									  break
									case 110:
									  line_color = 'red'
									  line_style = 'solid'
									  line_weight = 2
									  break
									case 35:
									  line_color = '#0000EE'
									  line_style = 'solid'
									  line_weight = 2
									  break
								  }
								}else{
								    line_color = '#080808'
									  line_style = 'solid'
									  line_weight = 2
								}
                            }
                        }
                       if(p1&&p2){
                           var polygon = new BMap.Polyline([p1, p2], {strokeStyle: line_style, strokeColor: line_color, strokeWeight: line_weight, strokeOpacity: 1})
                           this.map.addOverlay(polygon)
                           li["line"]=polygon
                           this.selectedLine.push(polygon)
                       }

                   }
                this.showInfo(1);
            },

            //画整条线路 如 ml512 yd511
            drawLine(_line){

                this.flines.push(_line)
                this.getLine(_line)  // 获取线路点线
                this.getLineData(_line)  // 获取线路数据
                this.type = '线路'
//                this.activeName = 'first'
                document.getElementById('tabs').style.display = 'none'; //让标签页隐藏

                // 先清理地图上的所选线路的点和连线
                if(this.allMarker.length != 0 ){
                    for(let pp of this.allMarker){
                        this.map.removeOverlay(pp)
                    }
                }
                if(this.selectedPoint.length != 0){
                    for (let item of this.selectedPoint) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                if(this.selectedLine.length != 0){
                    for (let item of this.selectedLine) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                if(this.selectedPoint2.length != 0){
                    for (let item of this.selectedPoint2) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                if(this.wjj.length != 0){
                    for (let item of this.wjj) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                //1. 画出该线路上的所有点 包括配变、开闭站、环网柜、杆塔
                console.log(this.point_l)
                for(let po of this.point_l){
                    var icon = ''
                    var label = new BMap.Label(po.name, { offset: new BMap.Size(-30, 45) })
                    if(po.voltage !== null){
                        if(po.voltage=== 35){
                            icon = new BMap.Icon('./images/35.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                        }else if(po.voltage===110){
                            icon = new BMap.Icon('./images/110.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                        }else if(po.voltage=== 220){
                            icon = new BMap.Icon('./images/220.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                        }
                    }  else {
                        console.log(po.type)
                       switch(po.type){
                         case '环网柜':
                           icon = new BMap.Icon('./images/hwg.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                           break;
                         case '开闭站':
                          icon = new BMap.Icon('./images/kbz.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                           break;
                       case '配电室':
                           icon = new BMap.Icon('./images/pd.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                           break;
                       case '箱式变电站':
                           icon = new BMap.Icon('./images/xb.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                           break;
                       case '熔断器':
                           icon = new BMap.Icon('./images/rdq.png', new BMap.Size(26, 60), { fillOpacity: 0.5, anchor: new BMap.Size(13, 30) })
                           break;
                       case "电缆分接箱":
                           icon = new BMap.Icon('./images/df.png', new BMap.Size(70, 70), { fillOpacity: 0.5, anchor: new BMap.Size(35, 35) })
                           break;
                       case '杆塔':
                          icon = new BMap.Icon('./images/gt.png', new BMap.Size(15, 15), { fillOpacity: 0.5, anchor: new BMap.Size(8, 8) })
                           break;
                       case '配变':
                           icon = new BMap.Icon('./images/pb.png', new BMap.Size(70, 44), { fillOpacity: 0.5, anchor: new BMap.Size(35, 22) })
                           break
                       }
                     }

                    var p0 = new BMap.Point(po.lg, po.lat)
                    var m0 = new BMap.Marker(p0, { icon: icon })
                       this.map.addOverlay(m0)
                        po["marker"]=m0


                    po["isShow"]= 'true';
                    this.selectedPoint.push(m0)
                }
                // 2. 画出该线路的连线
                var p1,p2

                for (let li of this.line_l) {
                        for(let po of this.point_l){
                            if(po.id === li.source){
                                p1 = new BMap.Point(po.lg, po.lat)
                            }
                            if(po.id === li.target){
                                p2 = new BMap.Point(po.lg, po.lat)
                            }
                        }

                        var polygon = new BMap.Polyline([p1, p2], {strokeColor: '#080808', strokeWeight: 2, strokeOpacity: 1})
                        this.map.addOverlay(polygon)
                      li["line"]=polygon
                        this.selectedLine.push(polygon)

                }
                this.map.centerAndZoom(p1,16); // 放大居中
                this.showInfo(1);
            },
        getline_s(sp,tp){
            var x1,y1,x2,y2
            $.ajax({
                url: "http://127.0.0.1:8089/web/map/queryPoint",// 按条件筛选设备的接口
//                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                type: "POST",
                data: '{"id":"'+sp+'"}',
                contentType:"application/json",
                dataType:"json",
                async:false,
                success: function(data) {
                    x1=0.5*data[0].lg
                    y1=0.5*data[0].lat
                }
            })
            $.ajax({
                url: "http://127.0.0.1:8089/web/map/queryPoint",// 按条件筛选设备的接口
//                    url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                type: "POST",
                data: '{"id":"'+tp+'"}',
                contentType:"application/json",
                dataType:"json",
                async:false,
                success: function(data) {
                    x2=0.5*data[0].lg
                    y2=0.5*data[0].lat
                }
            })
            $.ajax({
                url: "http://127.0.0.1:8089/web/map/queryLine",// 按条件筛选线路的接口
                type: "POST",
                data: '{ "source":"'+ sp+'","target":"'+ tp+'"}',  // 通过 id 筛选连线
                contentType:"application/json",
                dataType:"json",
                async:false,
                success: function(data) {//请求成功完成后要执行的方法

//                        var result = JSON.stringify(data); //json对象转成字符串
                    that.line_s = data;

                }
            })
        },
            //画一根线段 如 营子-梅岭沟  参数是线段的起始点的id
            drawLine_s(sp,tp){
                   this.getline_s(sp,tp)
                if(this.selectedLine_s.length != 0){
                    for (let item of this.selectedLine_s) {
                        this.map.removeOverlay(item)  // 先清理地图上的所选线路
                    }
                }
                var p1,p2
//
                for(let po of this.point_d){
                    if(po.id === sp){
                        p1 = new BMap.Point(po.lg, po.lat)
                    }
                    if(po.id === tp){
                        p2 = new BMap.Point(po.lg, po.lat)
                    }
                    if(p1&&p2){
                        var polygon = new BMap.Polyline([p1, p2], {strokeColor: 'blue', strokeWeight: 2, strokeOpacity: 1})
                        this.map.addOverlay(polygon)
                        this.selectedLine_s.push(polygon)
                    }
                }
                this.map.centerAndZoom(p1,15); // 放大居中
            },
            //缩放
            zoomchange( msg){
                if(msg == 'zoomIn'){
//                    let z =this.map.getZoom()
//                    z = z+2
//                    this.map.setZoom(z)
                    this.map.zoomIn()
                    this.showInfo(1)
                }else{
//                    let z =this.map.getZoom()
//                    z = z-2
//                    this.map.setZoom(z)
                    this.map.zoomOut()
                    this.showInfo(1)
                }
            },
        }
    })
</script>
<script type="text/javascript">
    function setLocation( x,y,z) {
        this.map.centerAndZoom(new BMap.Point(x,y), z);
    }
</script>
</body>
</html>